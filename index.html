<!DOCTYPE html>
<html lang="tr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="YKS TYT Net Takip Sistemi - Sınav performansınızı takip edin ve gelişiminizi görün">
  <title>YKS (TYT) Net Takip Sistemi</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(to bottom right, #f8fafc, #eff6ff);
      min-height: 100vh;
    }

    .card {
      background-color: white;
      border-radius: 0.75rem;
      box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1);
      padding: 1.5rem;
      border: 1px solid #e2e8f0;
      transition: box-shadow 0.3s;
    }

    .card:hover {
      box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1);
    }

    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, .3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
  </style>
</head>

<body>
  <div id="root"></div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    // Firebase yapılandırması - BURAYA KENDİ FIREBASE CONFIG'İNİZİ EKLEYİN
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // Firebase'i başlat
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Global olarak erişilebilir yap
    window.firebaseDB = db;
    window.firebaseModules = { collection, addDoc, getDocs, deleteDoc, doc, query, orderBy };
  </script>

  <!-- Babel Standalone -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- React and ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Recharts -->
  <script src="https://unpkg.com/recharts@2.5.0/dist/Recharts.js"></script>

  <script type="text/babel">
    const { useState, useEffect } = React;
    const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = Recharts;
    const { collection, addDoc, getDocs, deleteDoc, doc, query, orderBy } = window.firebaseModules;
    const db = window.firebaseDB;

    // Icon components
    const Icon = ({ name, className = "w-6 h-6" }) => {
      const icons = {
        award: <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" /></svg>,
        trendingUp: <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>,
        plus: <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" /></svg>,
        calendar: <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>,
        trash: <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>,
        cloud: <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" /></svg>
      };
      return icons[name] || null;
    };

    function App() {
      const [exams, setExams] = useState([]);
      const [loading, setLoading] = useState(true);
      const [syncing, setSyncing] = useState(false);
      const [formData, setFormData] = useState({
        date: new Date().toISOString().split('T')[0],
        name: '',
        turkce: { dogru: 0, yanlis: 0 },
        sosyal: { dogru: 0, yanlis: 0 },
        matematik: { dogru: 0, yanlis: 0 },
        fen: { dogru: 0, yanlis: 0 }
      });

      // Firebase'den veri yükle
      useEffect(() => {
        loadExamsFromFirebase();
      }, []);

      const loadExamsFromFirebase = async () => {
        try {
          setLoading(true);
          const q = query(collection(db, 'exams'), orderBy('date', 'asc'));
          const querySnapshot = await getDocs(q);
          const loadedExams = [];
          querySnapshot.forEach((doc) => {
            loadedExams.push({ ...doc.data(), firebaseId: doc.id });
          });
          setExams(loadedExams);
        } catch (error) {
          console.error("Firebase'den veri yüklenirken hata:", error);
          // Hata durumunda localStorage'dan yükle
          const savedExams = localStorage.getItem('yks-exams');
          if (savedExams) {
            setExams(JSON.parse(savedExams));
          }
        } finally {
          setLoading(false);
        }
      };

      // localStorage'a da kaydet (yedek)
      useEffect(() => {
        if (exams.length > 0) {
          localStorage.setItem('yks-exams', JSON.stringify(exams));
        }
      }, [exams]);

      const calculateNet = (dogru, yanlis) => {
        return Math.max(0, dogru - (yanlis / 4)).toFixed(2);
      };

      const handleInputChange = (subject, field, value) => {
        const numValue = Math.max(0, parseInt(value) || 0);
        setFormData(prev => ({
          ...prev,
          [subject]: {
            ...prev[subject],
            [field]: numValue
          }
        }));
      };

      const handleSubmit = async (e) => {
        e.preventDefault();

        if (!formData.name.trim()) {
          alert('Lütfen sınav adını girin!');
          return;
        }

        setSyncing(true);

        const newExam = {
          id: Date.now(),
          date: formData.date,
          name: formData.name,
          nets: {
            turkce: parseFloat(calculateNet(formData.turkce.dogru, formData.turkce.yanlis)),
            sosyal: parseFloat(calculateNet(formData.sosyal.dogru, formData.sosyal.yanlis)),
            matematik: parseFloat(calculateNet(formData.matematik.dogru, formData.matematik.yanlis)),
            fen: parseFloat(calculateNet(formData.fen.dogru, formData.fen.yanlis))
          }
        };

        newExam.totalNet = (newExam.nets.turkce + newExam.nets.sosyal + newExam.nets.matematik + newExam.nets.fen).toFixed(2);

        try {
          // Firebase'e kaydet
          const docRef = await addDoc(collection(db, 'exams'), newExam);
          newExam.firebaseId = docRef.id;

          setExams(prev => [...prev, newExam].sort((a, b) => new Date(a.date) - new Date(b.date)));

          // Formu sıfırla
          setFormData({
            date: new Date().toISOString().split('T')[0],
            name: '',
            turkce: { dogru: 0, yanlis: 0 },
            sosyal: { dogru: 0, yanlis: 0 },
            matematik: { dogru: 0, yanlis: 0 },
            fen: { dogru: 0, yanlis: 0 }
          });
        } catch (error) {
          console.error("Firebase'e kaydetme hatası:", error);
          alert('Sınav kaydedilirken bir hata oluştu. Lütfen internet bağlantınızı kontrol edin.');
        } finally {
          setSyncing(false);
        }
      };

      const handleDelete = async (exam) => {
        if (!confirm('Bu sınavı silmek istediğinizden emin misiniz?')) {
          return;
        }

        setSyncing(true);
        try {
          // Firebase'den sil
          if (exam.firebaseId) {
            await deleteDoc(doc(db, 'exams', exam.firebaseId));
          }

          setExams(prev => prev.filter(e => e.id !== exam.id));

          if (exams.length === 1) {
            localStorage.removeItem('yks-exams');
          }
        } catch (error) {
          console.error("Firebase'den silme hatası:", error);
          alert('Sınav silinirken bir hata oluştu.');
        } finally {
          setSyncing(false);
        }
      };

      const stats = {
        highestNet: exams.length > 0 ? Math.max(...exams.map(e => parseFloat(e.totalNet))) : 0,
        averageNet: exams.length > 0
          ? (exams.reduce((sum, e) => sum + parseFloat(e.totalNet), 0) / exams.length).toFixed(2)
          : 0
      };

      const chartData = exams.map(exam => ({
        date: new Date(exam.date).toLocaleDateString('tr-TR', { day: '2-digit', month: '2-digit' }),
        'Toplam Net': parseFloat(exam.totalNet),
        name: exam.name
      }));

      if (loading) {
        return (
          <div className="min-h-screen flex items-center justify-center">
            <div className="text-center">
              <div className="loading mx-auto mb-4" style={{ borderTopColor: '#0284c7', width: '40px', height: '40px' }}></div>
              <p className="text-slate-600">Veriler yükleniyor...</p>
            </div>
          </div>
        );
      }

      return (
        <div className="min-h-screen py-8 px-4 sm:px-6 lg:px-8">
          <div className="max-w-7xl mx-auto">
            <div className="text-center mb-8">
              <h1 className="text-4xl sm:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-blue-800 mb-2">
                YKS (TYT) Net Takip Sistemi
              </h1>
              <p className="text-slate-600 text-lg">Sınav performansınızı takip edin ve gelişiminizi görün</p>
              {syncing && (
                <div className="mt-2 flex items-center justify-center gap-2 text-blue-600">
                  <div className="loading" style={{ width: '16px', height: '16px', borderTopColor: '#0284c7' }}></div>
                  <span className="text-sm">Senkronize ediliyor...</span>
                </div>
              )}
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
              <div className="card bg-gradient-to-br from-green-50 to-emerald-50 border-green-200">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-sm font-medium text-green-600 mb-1">En Yüksek Net</p>
                    <p className="text-3xl font-bold text-green-700">{stats.highestNet.toFixed(2)}</p>
                  </div>
                  <div className="bg-green-500 p-3 rounded-full text-white">
                    <Icon name="award" className="w-8 h-8" />
                  </div>
                </div>
              </div>

              <div className="card bg-gradient-to-br from-blue-50 to-indigo-50 border-blue-200">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-sm font-medium text-blue-600 mb-1">Ortalama Net</p>
                    <p className="text-3xl font-bold text-blue-700">{stats.averageNet}</p>
                  </div>
                  <div className="bg-blue-500 p-3 rounded-full text-white">
                    <Icon name="trendingUp" className="w-8 h-8" />
                  </div>
                </div>
              </div>
            </div>

            <div className="card mb-8">
              <h2 className="text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2">
                <Icon name="plus" className="w-6 h-6 text-blue-600" />
                Yeni Sınav Ekle
              </h2>

              <form onSubmit={handleSubmit} className="space-y-6">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label className="block text-sm font-semibold text-slate-700 mb-2">
                      <Icon name="calendar" className="w-4 h-4 inline mr-1" />
                      Sınav Tarihi
                    </label>
                    <input
                      type="date"
                      value={formData.date}
                      onChange={(e) => setFormData(prev => ({ ...prev, date: e.target.value }))}
                      className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"
                      required
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-semibold text-slate-700 mb-2">
                      Sınav Adı / Yayınevi
                    </label>
                    <input
                      type="text"
                      value={formData.name}
                      onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}
                      placeholder="Örn: TYT Deneme 1 - Acil Yayınları"
                      className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"
                      required
                    />
                  </div>
                </div>

                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                  {[
                    { key: 'turkce', label: 'Türkçe', color: 'red' },
                    { key: 'sosyal', label: 'Sosyal Bilimler', color: 'yellow' },
                    { key: 'matematik', label: 'Matematik', color: 'blue' },
                    { key: 'fen', label: 'Fen Bilimleri', color: 'green' }
                  ].map(subject => (
                    <div key={subject.key} className={`p-4 rounded-lg border-2 border-${subject.color}-200 bg-${subject.color}-50`}>
                      <h3 className="font-semibold text-slate-800 mb-3">{subject.label}</h3>
                      <div className="grid grid-cols-3 gap-3">
                        <div>
                          <label className="block text-xs font-medium text-slate-600 mb-1">Doğru</label>
                          <input
                            type="number"
                            min="0"
                            value={formData[subject.key].dogru}
                            onChange={(e) => handleInputChange(subject.key, 'dogru', e.target.value)}
                            className="w-full px-2 py-2 border border-slate-300 rounded-lg text-center focus:ring-2 focus:ring-blue-500 outline-none"
                          />
                        </div>
                        <div>
                          <label className="block text-xs font-medium text-slate-600 mb-1">Yanlış</label>
                          <input
                            type="number"
                            min="0"
                            value={formData[subject.key].yanlis}
                            onChange={(e) => handleInputChange(subject.key, 'yanlis', e.target.value)}
                            className="w-full px-2 py-2 border border-slate-300 rounded-lg text-center focus:ring-2 focus:ring-blue-500 outline-none"
                          />
                        </div>
                        <div>
                          <label className="block text-xs font-medium text-slate-600 mb-1">Net</label>
                          <div className="w-full px-2 py-2 bg-slate-100 rounded-lg text-center font-bold text-blue-700 border border-slate-300">
                            {calculateNet(formData[subject.key].dogru, formData[subject.key].yanlis)}
                          </div>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>

                <button
                  type="submit"
                  disabled={syncing}
                  className="bg-gradient-to-r from-blue-600 to-blue-700 text-white px-6 py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-blue-800 transition-all duration-200 shadow-md hover:shadow-lg transform hover:-translate-y-0.5 w-full md:w-auto disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  {syncing ? (
                    <>
                      <div className="loading inline-block mr-2" style={{ width: '16px', height: '16px' }}></div>
                      Kaydediliyor...
                    </>
                  ) : (
                    <>
                      <Icon name="plus" className="w-5 h-5 inline mr-2" />
                      Sınavı Kaydet
                    </>
                  )}
                </button>
              </form>
            </div>

            {exams.length > 0 && (
              <div className="card mb-8">
                <h2 className="text-2xl font-bold text-slate-800 mb-6">Net Gelişim Grafiği</h2>
                <ResponsiveContainer width="100%" height={300}>
                  <LineChart data={chartData}>
                    <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
                    <XAxis dataKey="date" stroke="#64748b" style={{ fontSize: '12px' }} />
                    <YAxis stroke="#64748b" style={{ fontSize: '12px' }} />
                    <Tooltip
                      contentStyle={{
                        backgroundColor: '#fff',
                        border: '1px solid #e2e8f0',
                        borderRadius: '8px',
                        boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)'
                      }}
                    />
                    <Legend />
                    <Line
                      type="monotone"
                      dataKey="Toplam Net"
                      stroke="#0284c7"
                      strokeWidth={3}
                      dot={{ fill: '#0284c7', r: 5 }}
                      activeDot={{ r: 7 }}
                    />
                  </LineChart>
                </ResponsiveContainer>
              </div>
            )}

            {exams.length > 0 && (
              <div className="card">
                <h2 className="text-2xl font-bold text-slate-800 mb-6">Sınav Geçmişi</h2>
                <div className="overflow-x-auto">
                  <table className="w-full">
                    <thead>
                      <tr className="border-b-2 border-slate-200">
                        <th className="text-left py-3 px-4 font-semibold text-slate-700">Tarih</th>
                        <th className="text-left py-3 px-4 font-semibold text-slate-700">Sınav Adı</th>
                        <th className="text-center py-3 px-4 font-semibold text-slate-700">Türkçe</th>
                        <th className="text-center py-3 px-4 font-semibold text-slate-700">Sosyal</th>
                        <th className="text-center py-3 px-4 font-semibold text-slate-700">Matematik</th>
                        <th className="text-center py-3 px-4 font-semibold text-slate-700">Fen</th>
                        <th className="text-center py-3 px-4 font-semibold text-slate-700">Toplam</th>
                        <th className="text-center py-3 px-4 font-semibold text-slate-700">İşlem</th>
                      </tr>
                    </thead>
                    <tbody>
                      {exams.map((exam, index) => (
                        <tr
                          key={exam.id}
                          className={`border-b border-slate-100 hover:bg-slate-50 transition-colors ${index % 2 === 0 ? 'bg-white' : 'bg-slate-50'
                            }`}
                        >
                          <td className="py-3 px-4 text-sm">
                            {new Date(exam.date).toLocaleDateString('tr-TR')}
                          </td>
                          <td className="py-3 px-4 text-sm font-medium">{exam.name}</td>
                          <td className="py-3 px-4 text-center text-sm font-semibold text-red-600">
                            {exam.nets.turkce}
                          </td>
                          <td className="py-3 px-4 text-center text-sm font-semibold text-yellow-600">
                            {exam.nets.sosyal}
                          </td>
                          <td className="py-3 px-4 text-center text-sm font-semibold text-blue-600">
                            {exam.nets.matematik}
                          </td>
                          <td className="py-3 px-4 text-center text-sm font-semibold text-green-600">
                            {exam.nets.fen}
                          </td>
                          <td className="py-3 px-4 text-center text-sm font-bold text-blue-700">
                            {exam.totalNet}
                          </td>
                          <td className="py-3 px-4 text-center">
                            <button
                              onClick={() => handleDelete(exam)}
                              disabled={syncing}
                              className="bg-red-500 text-white px-3 py-1.5 rounded-lg hover:bg-red-600 transition-all duration-200 shadow-sm hover:shadow-md inline-flex items-center gap-1 disabled:opacity-50 disabled:cursor-not-allowed"
                              title="Sil"
                            >
                              <Icon name="trash" className="w-4 h-4" />
                            </button>
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              </div>
            )}

            {exams.length === 0 && (
              <div className="card text-center py-12">
                <div className="text-slate-400 mb-4">
                  <Icon name="calendar" className="w-16 h-16 mx-auto" />
                </div>
                <h3 className="text-xl font-semibold text-slate-600 mb-2">Henüz sınav kaydı yok</h3>
                <p className="text-slate-500">Yukarıdaki formu kullanarak ilk sınavınızı ekleyin!</p>
              </div>
            )}

            <div className="text-center mt-8 text-sm text-slate-500">
              <Icon name="cloud" className="w-4 h-4 inline mr-1" />
              Verileriniz Firebase'de güvenle saklanıyor
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>

</html>